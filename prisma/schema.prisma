generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// USER & ORGANIZATION
// ============================================

model User {
  id        String   @id @default(uuid()) @db.Uuid
  email     String   @unique
  fullName  String
  gender    String
  status    String   // PENDING | ACTIVE | INACTIVE
  role      String   // EMPLOYEE | DEPARTMENT_HEAD | HR | DIRECTOR
  hireDate  DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

model Department {
  id        String   @id @default(uuid()) @db.Uuid
  name      String
  code      String   @unique
  managerId String?  @db.Uuid
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("departments")
}

model DepartmentEmployee {
  departmentId String @db.Uuid
  employeeId   String @db.Uuid

  @@id([departmentId, employeeId])
  @@map("department_employees")
}

// ============================================
// LEAVE MANAGEMENT
// ============================================

model LeaveType {
  id                 String   @id @default(uuid()) @db.Uuid
  code               String   @unique
  name               String
  isPaid             Boolean  @default(false)
  deductCompensation Boolean  @default(false)
  createdAt          DateTime @default(now())

  @@map("leave_types")
}

model LeaveRequest {
  id          String    @id @default(uuid()) @db.Uuid
  leaveTypeId String    @db.Uuid
  status      String    // DRAFT | PENDING | APPROVED | REJECTED
  reason      String?
  fromDate    DateTime
  toDate      DateTime
  totalDays   Float
  createdBy   String    @db.Uuid
  createdAt   DateTime  @default(now())
  approvedBy  String?   @db.Uuid
  approvedAt  DateTime?

  @@index([createdBy])
  @@index([status])
  @@index([fromDate, toDate])
  @@map("leave_requests")
}

// ============================================
// OVERTIME MANAGEMENT
// ============================================

model OvertimeType {
  id                String   @id @default(uuid()) @db.Uuid
  code              String   @unique
  name              String
  defaultMultiplier Float
  isCompensation    Boolean  @default(false)
  createdAt         DateTime @default(now())

  @@map("overtime_types")
}

model OvertimeRequest {
  id         String    @id @default(uuid()) @db.Uuid
  userId     String    @db.Uuid
  workDate   DateTime
  startTime  DateTime
  endTime    DateTime
  totalHours Float
  otTypeId   String    @db.Uuid
  reason     String?
  status     String    // PENDING | REJECTED | APPROVED | DRAFT
  approvedBy String?   @db.Uuid
  approvedAt DateTime?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  @@index([userId])
  @@index([workDate])
  @@index([status])
  @@map("overtime_requests")
}

model CompensationBalance {
  id        String   @id @default(uuid()) @db.Uuid
  userId    String   @unique @db.Uuid
  hours     Float    @default(0)
  updatedAt DateTime @updatedAt

  @@map("compensation_balances")
}

// ============================================
// ATTENDANCE
// ============================================

model Attendance {
  id        String    @id @default(uuid()) @db.Uuid
  userId    String    @db.Uuid
  workDate  DateTime
  checkIn   DateTime?
  checkOut  DateTime?
  status    String    // SCHEDULED | IN_PROGRESS | COMPLETED
  plan      String?
  result    String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@unique([userId, workDate])
  @@index([userId, workDate])
  @@map("attendances")
}

// ============================================
// HOLIDAYS
// ============================================

model Holiday {
  id          String   @id @default(uuid()) @db.Uuid
  name        String
  date        DateTime
  type        String   // FIXED | CUSTOM
  session     String   // FULL | MORNING | AFTERNOON
  isRecurring Boolean  @default(false)
  createdBy   String   @db.Uuid
  createdAt   DateTime @default(now())

  @@index([date])
  @@map("holidays")
}

// ============================================
// POLICY ENGINE
// ============================================

model Policy {
  id          String  @id @default(uuid()) @db.Uuid
  name        String
  type        String  // LEAVE | OT
  priority    Int
  isActive    Boolean @default(true)
  leaveTypeId String? @db.Uuid

  @@map("policies")
}

model PolicyCondition {
  id           String  @id @default(uuid()) @db.Uuid
  policyId     String  @db.Uuid
  minYear      Int?
  maxYear      Int?
  departmentId String? @db.Uuid
  role         String? // EMPLOYEE | DEPARTMENT_HEAD | HR | DIRECTOR

  @@map("policy_conditions")
}

model LeavePolicyValue {
  id                   String  @id @default(uuid()) @db.Uuid
  policyId             String  @db.Uuid
  leaveTypeId          String  @db.Uuid
  maxDaysPerRequest    Float
  minimumNoticeDays    Int
  allowNegativeBalance Boolean @default(false)

  @@map("leave_policy_values")
}

model OTPolicyValue {
  id               String @id @default(uuid()) @db.Uuid
  policyId         String @db.Uuid
  otTypeId         String @db.Uuid
  maxHoursPerDay   Float
  salaryMultiplier Float

  @@map("ot_policy_values")
}